---
phase: 02-tree-visualization
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified: [src/renderer/features/workflows/ui/workflows-sidebar-section.tsx, src/renderer/features/workflows/ui/workflow-tree.tsx, src/renderer/features/sidebar/agents-sidebar.tsx]
autonomous: true
---

<objective>
Build the workflows sidebar section with nested dependency tree component.

Purpose: Create the UI layer that displays agents, commands, and their dependencies in an expandable tree view in the sidebar.

Output: Functional workflows sidebar section with tree visualization connected to tRPC data.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-discovery-layer/01-01-SUMMARY.md
@.planning/phases/01-discovery-layer/01-02-SUMMARY.md
@.planning/phases/02-tree-visualization/02-01-SUMMARY.md

# State layer (created in 02-01):
@src/renderer/features/workflows/atoms/index.ts

# Data source:
@src/main/lib/trpc/routers/workflows.ts

# UI patterns to follow:
@src/renderer/features/sidebar/agents-sidebar.tsx
@src/renderer/lib/atoms/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create WorkflowTree component with nested rendering</name>
  <files>src/renderer/features/workflows/ui/workflow-tree.tsx</files>
  <action>Create src/renderer/features/workflows/ui/workflow-tree.tsx component:

**Component structure:**
- Functional component with motion for animations
- Uses trpc.workflows.getWorkflowGraph.useQuery() to fetch data
- Renders nested tree structure: Agents (expandable) → dependencies grouped by type (tools, skills, mcpServers, agents, commands)

**Tree node types:**
1. **Root nodes**: "Agents", "Commands", "Skills" sections (always visible)
2. **Item nodes**: Individual agent/command/skill with name and description
3. **Dependency nodes**: Nested under agents, grouped by category (Tools, Skills, MCP Servers, Agents, Commands)
4. **Leaf nodes**: Individual dependency items

**Visual design:**
- Use ChevronDown/ChevronRight from lucide-react for expand/collapse indicators
- Use existing sidebar styling patterns from agents-sidebar.tsx (hover states, selected state, typography)
- Nesting with left padding (16px per level)
- Motion for smooth expand/collapse (AnimatePresence from motion/react)

**Interactions:**
- Click root node → toggle expanded state (via workflowsTreeExpandedNodesAtom)
- Click item node → set selectedWorkflowNodeAtom for preview (future phase)
- Empty state when no data

**Key props:**
- data: WorkflowGraph type (import from @/main/lib/trpc/routers/workflows - need to export types first)

Export as default following Radix UI patterns.
</action>
  <verify>
File exists, component renders without TypeScript errors, uses correct tRPC query, implements tree structure with expand/collapse.
  </verify>
  <done>
WorkflowTree component created with nested rendering, tRPC integration, expand/collapse interactions, and consistent sidebar styling.
</done>

</task>

<task type="auto">
  <name>Task 2: Create WorkflowsSidebarSection component</name>
  <files>src/renderer/features/workflows/ui/workflows-sidebar-section.tsx</files>
  <action>Create src/renderer/features/workflows/ui/workflows-sidebar-section.tsx component:

**Component structure:**
- Container component that renders WorkflowTree
- Section header with "Workflows" title and collapsible toggle
- Uses workflowsSidebarOpenAtom to track open/closed state
- Motion animation for section expand/collapse

**Visual design:**
- Match existing sidebar section styles from agents-sidebar.tsx
- Section header with icon (use Workflow or Network icon from lucide-react) and chevron
- Border separator between sections
- Consistent padding and spacing

**Integration:**
- Import and use workflowsSidebarOpenAtom for section open state
- Import WorkflowTree from ./workflow-tree
- Use motion and AnimatePresence for smooth transitions

Export as default.
</action>
  <verify>
File exists, component renders WorkflowTree, section header with toggle works, animations working.
  </verify>
  <done>
WorkflowsSidebarSection component created with header, toggle, and WorkflowTree integration.
</done>

</task>

<task type="auto">
  <name>Task 3: Export WorkflowGraph types and integrate section into main sidebar</name>
  <files>src/main/lib/trpc/routers/workflows.ts, src/renderer/features/sidebar/agents-sidebar.tsx</files>
  <action>
**Part A: Export types from workflows router**
In src/main/lib/trpc/routers/workflows.ts, export the types at the bottom:
- Export: AgentMetadata, CommandMetadata, SkillMetadata, DependencyGraph, AgentWithDependencies, WorkflowGraph

**Part B: Integrate WorkflowsSidebarSection into main sidebar**
In src/renderer/features/sidebar/agents-sidebar.tsx:
1. Import WorkflowsSidebarSection from ../../features/workflows/ui/workflows-sidebar-section
2. Import workflowsSidebarOpenAtom from ../../features/workflows/atoms
3. Add workflowsSidebarOpenAtom to the atoms imported from ../../lib/atoms (or import directly)
4. Render WorkflowsSidebarSection at the bottom of the sidebar content (before archive section, after main chat list)
5. Ensure section is properly positioned with correct styling

Follow existing patterns for how other sections are rendered in the sidebar.
</action>
  <verify>
WorkflowGraph types exported from workflows.ts. WorkflowsSidebarSection renders in main sidebar. Section toggles open/closed. Build succeeds: bun run build.
  </verify>
  <done>
Types exported and shared. Workflows section integrated into sidebar below chat list. Section toggle functional. Build passes.
</done>

</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] WorkflowTree component exists and renders correctly
- [ ] WorkflowsSidebarSection component exists with header toggle
- [ ] WorkflowGraph types exported from workflows router
- [ ] Workflows section visible in main sidebar
- [ ] Build succeeds: bun run build
- [ ] TypeScript compilation passes: bun run ts:check
- [ ] Tree expands/collapses on click
- [ ] Visual styling matches existing sidebar patterns
</verification>

<success_criteria>

- All three components created and integrated
- Workflows section visible and functional in sidebar
- Tree structure displays agents with nested dependencies
- Expand/collapse interactions work smoothly
- Build and type check pass
</success_criteria>

<output>
After completion, create `.planning/phases/02-tree-visualization/02-02-SUMMARY.md`
</output>
