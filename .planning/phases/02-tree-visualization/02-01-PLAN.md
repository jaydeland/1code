---
phase: 02-tree-visualization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/renderer/features/workflows/atoms/index.ts]
autonomous: true
---

<objective>
Create Jotai atoms for workflows tree state management.

Purpose: Establish the reactive state layer for the workflow inspector feature, following established Jotai patterns in the codebase.

Output: Workflows atoms file with tree state, expand/collapse, and selection atoms ready for UI components.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-discovery-layer/01-01-SUMMARY.md
@.planning/phases/01-discovery-layer/01-02-SUMMARY.md

# Existing patterns:
@src/renderer/lib/atoms/index.ts
@src/renderer/features/agents/atoms/index.ts
@src/main/lib/trpc/routers/workflows.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create workflows atoms file</name>
  <files>src/renderer/features/workflows/atoms/index.ts</files>
  <action>Create src/renderer/features/workflows/atoms/index.ts with the following atoms:

1. **workflowsSidebarOpenAtom** - Boolean atom for sidebar section open/closed state (use atomWithStorage for persistence: "workflows:sidebar-open")

2. **workflowsTreeExpandedNodesAtom** - atomWithStorage<Set<string>> for tracking which tree nodes are expanded. Key format: "agents", "commands", "skills", "agent:{id}", "command:{id}". Storage key: "workflows:expanded-nodes". Helper atoms for toggle/collapse/expand.

3. **selectedWorkflowNodeAtom** - Primitive atom storing the currently selected workflow node for preview. Type: { type: "agent" | "command" | "skill" | "tool" | "mcpServer", id: string, name: string, sourcePath: string } | null

4. **workflowsRefreshTriggerAtom** - Primitive number atom (0) that increments to trigger data refresh

Follow existing patterns from src/renderer/features/agents/atoms/index.ts for atomWithStorage usage and helper atom patterns. Export all atoms at the bottom.

Re-export from src/renderer/lib/atoms/index.ts is NOT needed yet (will add when UI components are created).
</action>
  <verify>
File exists at src/renderer/features/workflows/atoms/index.ts with all 4 atoms defined and exported. TypeScript compiles: bun run ts:check passes.
  </verify>
  <done>
Workflows atoms file created with 4 atoms: sidebar open state, expanded nodes set, selected node, and refresh trigger. All atoms properly typed and exported.
</done>

</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] File src/renderer/features/workflows/atoms/index.ts exists
- [ ] All 4 atoms are defined with correct types
- [ ] TypeScript compilation passes: bun run ts:check
- [ ] Atoms follow established Jotai patterns from the codebase
</verification>

<success_criteria>

- Workflows atoms file exists with proper exports
- All atoms are typed correctly
- TypeScript compilation succeeds
- Atoms are ready for consumption by UI components
</success_criteria>

<output>
After completion, create `.planning/phases/02-tree-visualization/02-01-SUMMARY.md`
</output>
